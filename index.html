<!--version 0.0-->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âtat de la Batterie</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
            transition: background-color 2s ease-in-out; /* Transition de fond sur 2 secondes */
        }
        .info-batterie {
            font-size: 1.5em;
            margin-top: 20px;
            padding: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>Informations sur la Batterie</h1>
    <div class="info-batterie" id="niveau-batterie">Niveau de batterie : Inconnu</div>
    <div class="info-batterie" id="etat-charge">√âtat de charge : Inconnu</div>
    <div class="info-batterie" id="temps-restant">Temps restant : Inconnu</div>

    <!-- Audio pour branchement et d√©branchement -->
    <audio id="son-branchement" src="branche.wav" preload="auto"></audio>
    <audio id="son-debranchement" src="debranche.wav" preload="auto"></audio>

    <script>
        if (navigator.getBattery) {
            navigator.getBattery().then(function(batterie) {

                function mettreAJourBatterie(batterie) {
                    let niveauBatterie = Math.round(batterie.level * 100);
                    let rouge = Math.round(255 * (1 - batterie.level));
                    let vert = Math.round(255 * batterie.level);
                    let niveauElement = document.getElementById("niveau-batterie");

                    // Mise √† jour du texte et du fond
                    niveauElement.textContent = `Niveau de batterie : ${niveauBatterie}%`;
                    niveauElement.style.backgroundColor = `rgb(${rouge}, ${vert}, 100)`;
                    
                    document.getElementById("etat-charge").textContent = "√âtat de charge : " + (batterie.charging ? "En charge ‚ö°" : "Sur batterie üîã");

                    let texteTempsRestant = "";
                    let heureEstimee = "";

                    if (batterie.charging) {
                        // Si la batterie est en charge, on affiche le temps restant pour la charge
                        texteTempsRestant = batterie.chargingTime === Infinity ? 
                        "Temps restant pour la charge : Estimation non disponible ‚è≥" : 
                        `Temps restant pour la charge : ${Math.round(batterie.chargingTime / 60)} min`;

                        // Calcul de l'heure estim√©e pour la fin de la charge
                        if (batterie.chargingTime !== Infinity) {
                            heureEstimee = calculerHeureEstimee(batterie.chargingTime);
                        }
                    } else {
                        // Si la batterie se d√©charge, on affiche le temps restant avant d√©charge
                        texteTempsRestant = batterie.dischargingTime === Infinity ? 
                        "Temps restant avant d√©charge : Estimation non disponible ‚è≥" : 
                        `Temps restant avant d√©charge : ${Math.round(batterie.dischargingTime / 60)} min`;

                        // Calcul de l'heure estim√©e pour la fin de la d√©charge
                        if (batterie.dischargingTime !== Infinity) {
                            heureEstimee = calculerHeureEstimee(batterie.dischargingTime);
                        }
                    }

                    // Mise √† jour du texte
                    document.getElementById("temps-restant").textContent = texteTempsRestant + (heureEstimee ? ` (${heureEstimee})` : "");
                }

                // Fonction pour calculer l'heure estim√©e
                function calculerHeureEstimee(tempsRestantEnSecondes) {
                    let maintenant = new Date();
                    let tempsRestantEnMillisecondes = tempsRestantEnSecondes * 1000;
                    let heureEstimee = new Date(maintenant.getTime() + tempsRestantEnMillisecondes);

                    // Extraire l'heure et les minutes
                    let heures = heureEstimee.getHours();
                    let minutes = heureEstimee.getMinutes();

                    // Formatage de l'heure en 'hh:mm'
                    return `${heures}h${minutes < 10 ? "0" : ""}${minutes}`;
                }

                // Fonction pour changer l'animation de fond lors du branchement/d√©branchement
                function appliquerAnimationCharge(charging) {
                    let body = document.body;
                    let sonBranchement = document.getElementById("son-branchement");
                    let sonDebranchement = document.getElementById("son-debranchement");

                    if (charging) {
                        // Si branch√©, on lance l'animation vers vert et le son de branchement
                        body.style.backgroundColor = "#4CAF50";  // Vert
                        sonBranchement.play();
                    } else {
                        // Si d√©branch√©, on lance l'animation vers rouge uni et le son de d√©branchement
                        body.style.backgroundColor = "#FF6666";  // Rouge uni
                        sonDebranchement.play();
                    }
                }

                // Appliquer les changements √† l'ouverture en fonction de l'√©tat de charge
                function appliquerEtatInitial() {
                    let body = document.body;
                    if (batterie.charging) {
                        body.style.backgroundColor = "#4CAF50"; // Vert
                        document.getElementById("etat-charge").textContent = "√âtat de charge : En charge ‚ö°";
                        document.getElementById("son-branchement").play();
                    } else {
                        body.style.backgroundColor = "#FF6666"; // Rouge
                        document.getElementById("etat-charge").textContent = "√âtat de charge : Sur batterie üîã";
                        document.getElementById("son-debranchement").play();
                    }
                }

                // Appliquer l'√©tat initial √† l'ouverture de la page
                appliquerEtatInitial();
                
                // Appelle la fonction pour mettre √† jour l'√©tat de la batterie d√®s que la page charge
                mettreAJourBatterie(batterie);

                // Ajoute les √©couteurs d'√©v√©nements pour mettre √† jour l'interface lors des changements
                batterie.addEventListener('chargingchange', () => {
                    mettreAJourBatterie(batterie);
                    appliquerAnimationCharge(batterie.charging); // Applique l'animation au changement d'√©tat
                });
                batterie.addEventListener('levelchange', () => mettreAJourBatterie(batterie));
                batterie.addEventListener('chargingtimechange', () => mettreAJourBatterie(batterie));
                batterie.addEventListener('dischargingtimechange', () => mettreAJourBatterie(batterie));
            });
        } else {
            // Si l'API Battery Status n'est pas support√©e, on affiche un message d'erreur
            document.getElementById("niveau-batterie").textContent = "L'API Battery Status n'est pas support√©e par votre navigateur. Veuillez mettre √† jour votre navigateur.";
        }
    </script>
</body>
</html>