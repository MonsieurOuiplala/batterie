<!--version 0.1-->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âtat de la Batterie</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
            transition: background-color 2s ease-in-out; /* Transition de fond */
        }

        .info-batterie {
            font-size: 1.5em;
            margin-top: 20px;
            padding: 10px;
            border-radius: 8px;
            background-color: #f0f0f0;
        }

        .indicateur-batterie {
            width: 100px;
            height: 40px;
            border: 2px solid #000;
            border-radius: 5px;
            position: relative;
            margin: 20px auto;
        }

        .niveau-batterie {
            height: 100%;
            background-color: #2E7D32;
            width: 0%;
            transition: width 0.5s ease-in-out;
        }

        @media (max-width: 600px) {
            body {
                margin: 20px;
            }

            .info-batterie {
                font-size: 1.2em;
            }
        }
    </style>
</head>
<body>
    <h1>Informations sur la Batterie</h1>
    <div class="info-batterie" id="niveau-batterie">Niveau de batterie : Inconnu</div>
    <div class="info-batterie" id="etat-charge">√âtat de charge : Inconnu</div>
    <div class="info-batterie" id="temps-restant">Temps restant : Inconnu</div>
    <div class="indicateur-batterie">
        <div class="niveau-batterie" id="barre-niveau-batterie"></div>
    </div>

    <script>
        if (navigator.getBattery) {
            navigator.getBattery().then(function(batterie) {

                function mettreAJourBatterie(batterie) {
                    let niveauBatterie = Math.round(batterie.level * 100);
                    let rouge = Math.round(255 * (1 - batterie.level));
                    let vert = Math.round(255 * batterie.level);
                    let niveauElement = document.getElementById("niveau-batterie");

                    // Mise √† jour du texte et du fond
                    niveauElement.textContent = `Niveau de batterie : ${niveauBatterie}%`;
                    niveauElement.style.backgroundColor = `rgb(${rouge}, ${vert}, 100)`;

                    // Mise √† jour de la barre de niveau de batterie
                    document.getElementById("barre-niveau-batterie").style.width = `${niveauBatterie}%`;

                    // Mise √† jour de l'√©tat de charge
                    document.getElementById("etat-charge").textContent = "√âtat de charge : " + (batterie.charging ? "En charge ‚ö°" : "Sur batterie üîã");

                    // Mise √† jour du temps restant
                    let texteTempsRestant = "";
                    let heureEstimee = "";

                    if (batterie.charging) {
                        texteTempsRestant = batterie.chargingTime === Infinity ? 
                        "Temps restant pour la charge : Estimation non disponible ‚è≥" : 
                        `Temps restant pour la charge : ${formaterTempsRestant(batterie.chargingTime)}`;

                        if (batterie.chargingTime !== Infinity) {
                            heureEstimee = calculerHeureEstimee(batterie.chargingTime);
                        }
                    } else {
                        texteTempsRestant = batterie.dischargingTime === Infinity ? 
                        "Temps restant avant d√©charge : Estimation non disponible ‚è≥" : 
                        `Temps restant avant d√©charge : ${formaterTempsRestant(batterie.dischargingTime)}`;

                        if (batterie.dischargingTime !== Infinity) {
                            heureEstimee = calculerHeureEstimee(batterie.dischargingTime);
                        }
                    }

                    document.getElementById("temps-restant").textContent = texteTempsRestant + (heureEstimee ? ` (${heureEstimee})` : "");
                }

                function formaterTempsRestant(tempsEnSecondes) {
                    let heures = Math.floor(tempsEnSecondes / 3600);
                    let minutes = Math.floor((tempsEnSecondes % 3600) / 60);
                    return `${heures > 0 ? `${heures}h ` : ""}${minutes}min`;
                }

                function calculerHeureEstimee(tempsRestantEnSecondes) {
                    let maintenant = new Date();
                    let tempsRestantEnMillisecondes = tempsRestantEnSecondes * 1000;
                    let heureEstimee = new Date(maintenant.getTime() + tempsRestantEnMillisecondes);

                    let heures = heureEstimee.getHours();
                    let minutes = heureEstimee.getMinutes();

                    return `${heures}h${minutes < 10 ? "0" : ""}${minutes}`;
                }

                function appliquerAnimationCharge(charging) {
                    let body = document.body;
                    if (charging) {
                        body.style.backgroundColor = "#4CAF50"; // Vert
                    } else {
                        body.style.backgroundColor = "#FF6666"; // Rouge
                    }
                }

                function appliquerEtatInitial() {
                    let body = document.body;
                    if (batterie.charging) {
                        body.style.backgroundColor = "#4CAF50"; // Vert
                    } else {
                        body.style.backgroundColor = "#FF6666"; // Rouge
                    }
                }

                // Appliquer l'√©tat initial √† l'ouverture de la page
                appliquerEtatInitial();
                mettreAJourBatterie(batterie);

                // Ajouter les √©couteurs d'√©v√©nements
                batterie.addEventListener('chargingchange', () => {
                    mettreAJourBatterie(batterie);
                    appliquerAnimationCharge(batterie.charging);
                });
                batterie.addEventListener('levelchange', () => mettreAJourBatterie(batterie));
                batterie.addEventListener('chargingtimechange', () => mettreAJourBatterie(batterie));
                batterie.addEventListener('dischargingtimechange', () => mettreAJourBatterie(batterie));
            });
        } else {
            document.getElementById("niveau-batterie").textContent = "L'API Battery Status n'est pas support√©e par votre navigateur.";
        }
    </script>
</body>
</html>
